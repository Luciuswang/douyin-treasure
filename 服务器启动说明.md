# 🔧 后端服务器启动说明

## 问题：注册/登录时显示"网络错误，请检查服务器连接"

这个错误通常是因为**后端服务器没有运行**。请按照以下步骤启动后端服务器：

## 📋 前置要求

1. **Node.js** (版本 >= 16.0.0)
2. **MongoDB** (本地或云端)
3. **安装依赖包**

## 🚀 快速启动

### 方法1：使用批处理文件（Windows）

双击运行 `启动后端服务器.bat`

### 方法2：使用命令行

```bash
# 1. 安装依赖（如果还没安装）
npm install express mongoose jsonwebtoken bcryptjs joi cors helmet compression express-rate-limit socket.io dotenv

# 2. 启动后端服务器
npm run server

# 或者
cd server
node index.js
```

## ⚙️ 环境配置

1. **创建 `.env` 文件**（在项目根目录）

```env
# MongoDB连接地址
MONGODB_URI=mongodb://localhost:27017/totofun-treasure

# JWT密钥（请修改为随机字符串）
JWT_SECRET=your_default_secret_key_change_this_in_production
JWT_REFRESH_SECRET=your_refresh_secret_key_change_this_in_production
JWT_EXPIRES_IN=7d

# 客户端地址
CLIENT_URL=http://localhost:3000

# 服务器端口
PORT=5000

# 环境
NODE_ENV=development
```

2. **启动MongoDB**

如果使用本地MongoDB：
```bash
# Windows
net start MongoDB

# Mac/Linux
mongod
```

或者使用MongoDB Atlas（云端）：
- 注册账号：https://www.mongodb.com/cloud/atlas
- 获取连接字符串
- 更新 `.env` 中的 `MONGODB_URI`

## ✅ 验证服务器是否运行

打开浏览器访问：http://localhost:5000/health

如果看到以下响应，说明服务器运行正常：
```json
{
  "status": "ok",
  "timestamp": "...",
  "uptime": ...,
  "environment": "development"
}
```

## 🔍 常见问题

### 1. 端口5000已被占用

修改 `server/index.js` 中的端口号，或设置环境变量：
```bash
PORT=5001 npm run server
```

### 2. MongoDB连接失败

- 检查MongoDB是否运行
- 检查 `.env` 中的 `MONGODB_URI` 是否正确
- 如果使用MongoDB Atlas，确保IP白名单已添加

### 3. 依赖包缺失

运行：
```bash
npm install express mongoose jsonwebtoken bcryptjs joi cors helmet compression express-rate-limit socket.io dotenv
```

### 4. CORS错误

服务器已配置允许所有本地开发环境的请求。如果仍有问题，检查 `server/index.js` 中的CORS配置。

## 📝 启动后的日志

成功启动后，你应该看到：
```
✅ MongoDB 连接成功
🚀 Totofun 突突翻服务器运行在端口 5000
🌐 环境: development
📱 客户端地址: http://localhost:3000
```

## 🎯 下一步

1. 确保后端服务器正在运行（端口5000）
2. 打开前端页面（index.html）
3. 尝试注册/登录

如果仍有问题，请检查浏览器控制台的错误信息。

