# GPSå®šä½é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜è¯Šæ–­

ä¹‹å‰ç‰ˆæœ¬å­˜åœ¨ä»¥ä¸‹ä¸»è¦é—®é¢˜ï¼š

### 1. **åæ ‡ç³»ç»Ÿä¸åŒ¹é…** â­ æ ¸å¿ƒé—®é¢˜
- **é—®é¢˜**: æµè§ˆå™¨GPSè¿”å›çš„æ˜¯ **WGS84åæ ‡ç³»**ï¼ˆå›½é™…æ ‡å‡†ï¼‰
- **åœ°å›¾ä½¿ç”¨**: é«˜å¾·åœ°å›¾ä½¿ç”¨ **GCJ-02åæ ‡ç³»**ï¼ˆä¸­å›½ç«æ˜Ÿåæ ‡ï¼‰
- **åæœ**: ç›´æ¥ä½¿ç”¨GPSåæ ‡ä¼šå¯¼è‡´ä½ç½®åç§»çº¦50-500ç±³
- **è§£å†³**: ä½¿ç”¨é«˜å¾·åœ°å›¾çš„ `AMap.convertFrom()` APIè¿›è¡Œåæ ‡è½¬æ¢

### 2. **å®šä½ç²¾åº¦é…ç½®ä¸å½“**
- **é—®é¢˜**: å¼ºåˆ¶è¦æ±‚é«˜ç²¾åº¦å®šä½ï¼Œå®¤å†…ç¯å¢ƒå®¹æ˜“å¤±è´¥
- **è§£å†³**: å…ˆå°è¯•é«˜ç²¾åº¦ï¼Œå¤±è´¥åé™çº§ä¸ºæ™®é€šç²¾åº¦

### 3. **ç”¨æˆ·æ ‡è®°æ˜¾ç¤ºé—®é¢˜**
- **é—®é¢˜**: æ ‡è®°å¯èƒ½æœªæ­£ç¡®æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š
- **è§£å†³**: 
  - ä½¿ç”¨ `new AMap.LngLat()` ç¡®ä¿åæ ‡æ ¼å¼æ­£ç¡®
  - æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
  - æ”¹è¿›æ ‡è®°å›¾æ ‡å’Œåç§»è®¾ç½®

### 4. **ç¼ºå°‘è°ƒè¯•ä¿¡æ¯**
- **é—®é¢˜**: å®šä½å¤±è´¥æ—¶æ— æ³•åˆ¤æ–­åŸå› 
- **è§£å†³**: æ·»åŠ å¤§é‡console.logè¾“å‡ºï¼Œä¾¿äºè°ƒè¯•

---

## ä¸»è¦æ”¹è¿›

### âœ… 1. åæ ‡è½¬æ¢ (WGS84 â†’ GCJ-02)

```javascript
// ä½¿ç”¨é«˜å¾·åœ°å›¾çš„åæ ‡è½¬æ¢API
AMap.convertFrom([lng, lat], 'gps', function(status, result) {
    if (result.info === 'ok' && result.locations && result.locations.length > 0) {
        const convertedLocation = result.locations[0];
        userLocation = [convertedLocation.lng, convertedLocation.lat];
        // ... åˆ›å»ºæ ‡è®°
    }
});
```

**æ•ˆæœ**: ä½ç½®ç²¾ç¡®åº¦æå‡ï¼Œæ ‡è®°æ˜¾ç¤ºåœ¨å®é™…GPSä½ç½®

---

### âœ… 2. é™çº§å®šä½ç­–ç•¥

```javascript
// å…ˆå°è¯•é«˜ç²¾åº¦
navigator.geolocation.getCurrentPosition(
    handleLocationSuccess,
    (error) => {
        // å¤±è´¥åå°è¯•æ™®é€šç²¾åº¦
        navigator.geolocation.getCurrentPosition(
            handleLocationSuccess,
            handleLocationError,
            {
                enableHighAccuracy: false,  // é™ä½ç²¾åº¦è¦æ±‚
                timeout: 15000,
                maximumAge: 0
            }
        );
    },
    {
        enableHighAccuracy: true,
        timeout: 8000,
        maximumAge: 0
    }
);
```

**æ•ˆæœ**: æé«˜å®šä½æˆåŠŸç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å®¤å†…ç¯å¢ƒ

---

### âœ… 3. æ”¹è¿›æ ‡è®°æ˜¾ç¤º

```javascript
userMarker = new AMap.Marker({
    position: new AMap.LngLat(userLocation[0], userLocation[1]),  // ä½¿ç”¨LngLatå¯¹è±¡
    icon: new AMap.Icon({
        image: 'data:image/svg+xml;base64,' + btoa(svgString),
        size: new AMap.Size(60, 60),
        imageOffset: new AMap.Pixel(0, 0)  // ä¿®æ­£å›¾æ ‡åç§»
    }),
    offset: new AMap.Pixel(-30, -30),  // æ ‡è®°åç§»ï¼Œä½¿å›¾æ ‡ä¸­å¿ƒå¯¹å‡†åæ ‡
    zIndex: 1000,
    animation: 'AMAP_ANIMATION_BOUNCE'
});
```

**æ•ˆæœ**: æ ‡è®°æ­£ç¡®æ˜¾ç¤ºä¸”ä½ç½®å‡†ç¡®

---

### âœ… 4. æ–°å¢åŠŸèƒ½

#### å›åˆ°æˆ‘çš„ä½ç½®æŒ‰é’®
```javascript
function centerToUser() {
    map.setCenter(userLocation);
    map.setZoom(17);
    userMarker.setAnimation('AMAP_ANIMATION_BOUNCE');  // å¼¹è·³åŠ¨ç”»æç¤º
}
```

#### è¯¦ç»†çš„GPSä¿¡æ¯æ˜¾ç¤º
- æ˜¾ç¤ºåŸå§‹WGS84åæ ‡
- æ˜¾ç¤ºè½¬æ¢åçš„GCJ-02åæ ‡
- æ˜¾ç¤ºç²¾åº¦è¯„ä¼°ï¼ˆâœ… < 100m, âš ï¸ 100-500m, âŒ > 500mï¼‰
- æ˜¾ç¤ºåŒºåŸŸåˆ¤æ–­ï¼ˆæ˜¯å¦åœ¨ä¸Šæµ·åœ°åŒºï¼‰

---

## æµ‹è¯•æŒ‡å—

### ğŸ  å®¤å†…æµ‹è¯•
1. æ‰“å¼€æ¸¸æˆé¡µé¢
2. è¾“å…¥é«˜å¾·åœ°å›¾API Key
3. ç‚¹å‡»"å¯åŠ¨å¯»å®ä¹‹æ—…"
4. å…è®¸ä½ç½®æƒé™
5. **é¢„æœŸ**: å¯èƒ½å®šä½ç²¾åº¦è¾ƒä½ï¼ˆ100-500ç±³ï¼‰ï¼Œä½†åº”è¯¥èƒ½æˆåŠŸå®šä½

### ğŸŒ³ æˆ·å¤–æµ‹è¯•
1. åœ¨æˆ·å¤–ç©ºæ—·åœ°å¸¦æ‰“å¼€æ¸¸æˆ
2. ç­‰å¾…GPSä¿¡å·ç¨³å®šï¼ˆå¯èƒ½éœ€è¦1-2åˆ†é’Ÿï¼‰
3. **é¢„æœŸ**: é«˜ç²¾åº¦å®šä½æˆåŠŸï¼ˆ< 50ç±³ï¼‰

### ğŸ” è°ƒè¯•æ–¹å¼
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹Consoleæ ‡ç­¾é¡µ
3. è§‚å¯Ÿè¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯ï¼š
   - åŸå§‹GPSåæ ‡
   - è½¬æ¢ååæ ‡
   - æ ‡è®°åˆ›å»ºçŠ¶æ€
   - åœ°å›¾äº‹ä»¶

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: ä½ç½®åç§»50-500ç±³
**åŸå› **: åæ ‡ç³»æœªè½¬æ¢  
**è§£å†³**: å·²ä¿®å¤ï¼Œç°åœ¨è‡ªåŠ¨è½¬æ¢ WGS84 â†’ GCJ-02

### Q2: æ ‡è®°ä¸æ˜¾ç¤º
**åŸå› **: 
- æ ‡è®°åˆ›å»ºå¤±è´¥
- åæ ‡æ ¼å¼é”™è¯¯
- z-indexå±‚çº§é—®é¢˜

**æ’æŸ¥**:
1. æ£€æŸ¥Consoleæ˜¯å¦æœ‰é”™è¯¯
2. æ£€æŸ¥æ˜¯å¦è¾“å‡º"ç”¨æˆ·æ ‡è®°åˆ›å»ºæˆåŠŸ"
3. ç‚¹å‡»"å›åˆ°æˆ‘çš„ä½ç½®"æŒ‰é’®æµ‹è¯•

### Q3: å®šä½å¤±è´¥
**åŸå› **:
- æœªæˆäºˆä½ç½®æƒé™
- å®¤å†…GPSä¿¡å·å¼±
- æµè§ˆå™¨ä¸æ”¯æŒ

**è§£å†³**:
1. ç¡®ä¿åœ¨HTTPSç¯å¢ƒï¼ˆGitHub Pagesè‡ªåŠ¨æ”¯æŒï¼‰
2. æ£€æŸ¥æµè§ˆå™¨æƒé™è®¾ç½®
3. å°è¯•åœ¨æˆ·å¤–æµ‹è¯•
4. å¤±è´¥æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨ä¸Šæµ·å¤–æ»©ä½œä¸ºé»˜è®¤ä½ç½®

### Q4: å®šä½å¾ˆæ…¢
**åŸå› **: GPSå†·å¯åŠ¨éœ€è¦æ—¶é—´  
**è§£å†³**: 
- ç­‰å¾…1-2åˆ†é’Ÿè®©GPSçƒ­æœº
- ç§»åŠ¨è®¾å¤‡æ•ˆæœé€šå¸¸æ›´å¥½
- æˆ·å¤–æ•ˆæœä¼˜äºå®¤å†…

---

## æŠ€æœ¯ç»†èŠ‚

### åæ ‡ç³»è¯´æ˜

| åæ ‡ç³» | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| WGS84 | å›½é™…æ ‡å‡†GPSåæ ‡ç³» | æµè§ˆå™¨GPSã€å›½é™…åœ°å›¾ |
| GCJ-02 | ä¸­å›½å›½æµ‹å±€ç«æ˜Ÿåæ ‡ç³» | é«˜å¾·åœ°å›¾ã€è…¾è®¯åœ°å›¾ |
| BD-09 | ç™¾åº¦åæ ‡ç³» | ç™¾åº¦åœ°å›¾ |

**é‡è¦**: åœ¨ä¸­å›½ï¼Œæ‰€æœ‰ç”µå­åœ°å›¾éƒ½å¿…é¡»ä½¿ç”¨åç§»åçš„åæ ‡ç³»ï¼ˆGCJ-02æˆ–BD-09ï¼‰

### åç§»è·ç¦»
- ç»åº¦/çº¬åº¦åç§»: çº¦ 0.001Â° - 0.005Â°
- å®é™…è·ç¦»åç§»: çº¦ 50ç±³ - 500ç±³ï¼ˆå–å†³äºä½ç½®ï¼‰

### è½¬æ¢æ–¹æ³•
```javascript
// é«˜å¾·åœ°å›¾æä¾›çš„è½¬æ¢API
AMap.convertFrom(lnglat, type, callback)
// typeå¯é€‰å€¼: 'gps' (WGS84), 'baidu' (BD-09), 'mapbar'
```

---

## ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. æŒç»­å®šä½
```javascript
// ä½¿ç”¨watchPositionæŒç»­è·Ÿè¸ªä½ç½®
watchId = navigator.geolocation.watchPosition(
    handleLocationSuccess,
    handleLocationError,
    { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
);
```

### 2. ä½ç½®å¹³æ»‘
- è®°å½•æœ€è¿‘Nä¸ªä½ç½®
- è®¡ç®—å¹³å‡å€¼å‡å°‘æŠ–åŠ¨

### 3. ç²¾åº¦æç¤º
- æ ¹æ®ç²¾åº¦æ˜¾ç¤ºä¸åŒçš„æ ‡è®°æ ·å¼
- ç²¾åº¦ < 20m: ç»¿è‰²å®å¿ƒåœ†
- ç²¾åº¦ 20-100m: é»„è‰²åŠé€æ˜åœ†
- ç²¾åº¦ > 100m: çº¢è‰²è™šçº¿åœ†

### 4. ç¦»çº¿æ”¯æŒ
- ç¼“å­˜æœ€åå·²çŸ¥ä½ç½®
- ä½¿ç”¨Service Workerç¼“å­˜åœ°å›¾ç“¦ç‰‡

---

## æ›´æ–°æ—¥å¿—

### 2024-10-16
- âœ… æ·»åŠ WGS84åˆ°GCJ-02åæ ‡è½¬æ¢
- âœ… å®ç°é™çº§å®šä½ç­–ç•¥
- âœ… æ”¹è¿›ç”¨æˆ·æ ‡è®°æ˜¾ç¤ºé€»è¾‘
- âœ… æ·»åŠ "å›åˆ°æˆ‘çš„ä½ç½®"åŠŸèƒ½
- âœ… å¢åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º
- âœ… ä¼˜åŒ–GPSä¿¡æ¯æ˜¾ç¤ºç•Œé¢

---

## æŠ€æœ¯æ ˆ
- **åœ°å›¾**: é«˜å¾·åœ°å›¾ JS API 2.0
- **å®šä½**: HTML5 Geolocation API
- **åæ ‡è½¬æ¢**: AMap.convertFrom()
- **å‰ç«¯**: åŸç”ŸJavaScript + HTML5 + CSS3

---

## å‚è€ƒèµ„æ–™
- [é«˜å¾·åœ°å›¾APIæ–‡æ¡£](https://lbs.amap.com/api/javascript-api/summary)
- [åæ ‡è½¬æ¢è¯´æ˜](https://lbs.amap.com/api/javascript-api/guide/transform/convertfrom)
- [Geolocation API](https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation_API)
- [ä¸­å›½åæ ‡ç³»ç»Ÿè¯´æ˜](https://github.com/googollee/eviltransform)


