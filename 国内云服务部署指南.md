# 🇨🇳 国内云服务部署指南

## 🎯 推荐方案（国内用户）

### 方案1：Vercel（推荐，国内可访问）⭐
- ✅ 国内访问速度快
- ✅ 完全免费
- ✅ 自动部署
- ✅ 支持Serverless函数
- 🔗 https://vercel.com

### 方案2：腾讯云开发（CloudBase）
- ✅ 国内服务，速度快
- ✅ 免费额度充足
- ✅ 支持Node.js
- ✅ 内置MongoDB
- 🔗 https://cloud.tencent.com/product/tcb

### 方案3：阿里云函数计算（FC）
- ✅ 国内服务
- ✅ 按量付费，很便宜
- ✅ 支持Node.js
- 🔗 https://www.aliyun.com/product/fc

### 方案4：LeanCloud（推荐，最简单）⭐⭐
- ✅ 国内服务，速度快
- ✅ 免费额度：30GB存储，10万次API调用/天
- ✅ 内置数据库（MongoDB兼容）
- ✅ 支持云函数
- ✅ 最简单易用
- 🔗 https://www.leancloud.cn

## 🚀 LeanCloud部署步骤（最推荐）

### 优势
- ✅ 国内访问速度快
- ✅ 免费额度充足
- ✅ 内置数据库，无需单独配置MongoDB
- ✅ 支持云函数（可以部署API）
- ✅ 有中文文档

### 步骤1：注册LeanCloud账号（2分钟）

1. 访问：https://www.leancloud.cn
2. 注册账号（支持手机号注册）
3. 创建应用（选择"开发版"，免费）

### 步骤2：配置数据库

1. 进入应用控制台
2. 点击 "数据存储" → "创建Class"
3. 创建以下Class：
   - `User`（用户表）
   - `Treasure`（宝藏表）
   - `Conversation`（对话表）

### 步骤3：部署API到云函数

LeanCloud支持云函数，但需要将Express应用改为云函数格式。

**或者使用更简单的方案：部署到Vercel**

## 🚀 Vercel部署步骤（推荐，国内可用）

### 优势
- ✅ 国内访问稳定
- ✅ 完全免费
- ✅ 自动部署
- ✅ 支持Express应用（通过Serverless函数）

### 步骤1：准备MongoDB Atlas（或使用LeanCloud数据库）

**选项A：MongoDB Atlas（国际版，但国内可访问）**
- 访问：https://www.mongodb.com/cloud/atlas
- 注册并创建免费集群
- 获取连接字符串

**选项B：LeanCloud数据库（推荐）**
- 使用LeanCloud的数据存储（MongoDB兼容）
- 获取REST API地址和密钥

### 步骤2：部署到Vercel

1. **安装Vercel CLI**
   ```bash
   npm install -g vercel
   ```

2. **登录Vercel**
   ```bash
   vercel login
   ```

3. **部署**
   ```bash
   cd server
   vercel
   ```
   
   按照提示：
   - 选择项目名称
   - 选择框架：Other
   - 设置环境变量（见下方）

4. **设置环境变量**
   在Vercel项目设置中添加：
   ```
   MONGODB_URI=你的MongoDB连接字符串
   JWT_SECRET=你的密钥
   JWT_REFRESH_SECRET=你的刷新密钥
   NODE_ENV=production
   ```

5. **获取部署地址**
   Vercel会给你一个地址，例如：`https://totofun-server.vercel.app`

### 步骤3：更新前端配置

在 `index.html` 中设置：
```javascript
CLOUD_API_URL: 'https://你的域名.vercel.app',
```

## 🚀 腾讯云开发部署（备选）

### 步骤1：注册腾讯云账号
- 访问：https://cloud.tencent.com
- 注册并实名认证

### 步骤2：创建云开发环境
1. 进入云开发控制台
2. 创建环境（选择免费版）
3. 开通云函数和数据库

### 步骤3：部署云函数
将server代码改为云函数格式部署

## 🚀 阿里云函数计算（备选）

### 步骤1：注册阿里云账号
- 访问：https://www.aliyun.com
- 注册并实名认证

### 步骤2：创建函数
1. 进入函数计算控制台
2. 创建函数（选择Node.js运行时）
3. 上传代码或连接GitHub

## 📝 推荐配置方案

### 最佳组合（国内用户）

1. **前端**：GitHub Pages（免费，国内可访问）
2. **后端**：Vercel（免费，国内访问稳定）
3. **数据库**：MongoDB Atlas 或 LeanCloud

### 完全国内方案

1. **前端**：GitHub Pages 或 Gitee Pages
2. **后端**：LeanCloud云函数 或 腾讯云开发
3. **数据库**：LeanCloud数据存储

## 🔧 修改代码支持LeanCloud

如果需要使用LeanCloud，我可以帮你：
1. 修改User模型使用LeanCloud SDK
2. 创建LeanCloud云函数
3. 更新API调用方式

## ✅ 测试访问速度

部署后，可以用以下工具测试：
- https://www.17ce.com（国内多节点测速）
- https://ping.pe（全球节点测试）

## 🆘 常见问题

**Q: Vercel国内能访问吗？**
A: 可以，Vercel在国内访问比较稳定，速度也还可以。

**Q: LeanCloud免费额度够用吗？**
A: 对于个人项目完全够用，30GB存储+10万次API调用/天。

**Q: 需要备案吗？**
A: 
- Vercel：不需要
- LeanCloud：不需要
- 腾讯云/阿里云：如果用国内服务器需要备案

**Q: 哪个最快？**
A: LeanCloud > 腾讯云 > Vercel > Railway（国内访问）

## 💡 建议

对于国内用户，我推荐：
1. **最简单**：LeanCloud（一站式解决方案）
2. **最灵活**：Vercel + MongoDB Atlas
3. **最稳定**：腾讯云开发

需要我帮你配置哪个方案？

