# 🇨🇳 国内用户推荐部署方案

## 🏆 最佳方案：Vercel + MongoDB Atlas

### 为什么推荐？
- ✅ **国内可访问**：Vercel在国内访问稳定
- ✅ **完全免费**：个人项目完全够用
- ✅ **自动部署**：连接GitHub自动部署
- ✅ **HTTPS自动**：自动配置SSL证书
- ✅ **全球CDN**：访问速度快

### 部署步骤

#### 1. 准备MongoDB Atlas（5分钟）

1. 访问：https://www.mongodb.com/cloud/atlas/register
2. 注册账号（免费）
3. 创建免费集群（M0 - 512MB）
4. 创建数据库用户：
   - Database Access → Add New Database User
   - 记住用户名和密码
5. 配置网络访问：
   - Network Access → Add IP Address
   - 选择 "Allow Access from Anywhere" (0.0.0.0/0)
6. 获取连接字符串：
   - Connect → Connect your application
   - 复制连接字符串，格式：
     ```
     mongodb+srv://用户名:密码@cluster0.xxxxx.mongodb.net/totofun-treasure?retryWrites=true&w=majority
     ```

#### 2. 部署到Vercel（10分钟）

**方法A：通过Vercel网站（推荐）**

1. 访问：https://vercel.com
2. 使用GitHub账号登录
3. 点击 "Add New Project"
4. 导入你的 `douyin-treasure` 仓库
5. 配置项目：
   - **Framework Preset**: Other
   - **Root Directory**: `server`
   - **Build Command**: `npm install`
   - **Output Directory**: (留空)
   - **Install Command**: `npm install`
6. 设置环境变量：
   ```
   MONGODB_URI=mongodb+srv://用户名:密码@cluster0.xxxxx.mongodb.net/totofun-treasure?retryWrites=true&w=majority
   JWT_SECRET=你的随机密钥（至少32字符）
   JWT_REFRESH_SECRET=另一个随机密钥
   JWT_EXPIRES_IN=7d
   NODE_ENV=production
   PORT=5000
   CLIENT_URL=https://luciuswang.github.io
   ```
7. 点击 "Deploy"
8. 等待部署完成（2-3分钟）
9. 获取部署地址（例如：`https://totofun-server.vercel.app`）

**方法B：通过CLI（可选）**

```bash
# 安装Vercel CLI
npm install -g vercel

# 登录
vercel login

# 进入server目录
cd server

# 部署
vercel

# 设置环境变量
vercel env add MONGODB_URI
vercel env add JWT_SECRET
vercel env add JWT_REFRESH_SECRET
# ... 其他变量
```

#### 3. 更新前端配置（1分钟）

1. 打开 `index.html`
2. 找到 `API_CONFIG`（约第723行）
3. 设置 `CLOUD_API_URL`：
   ```javascript
   CLOUD_API_URL: 'https://你的域名.vercel.app',
   ```
4. 保存并推送：
   ```bash
   git add index.html
   git commit -m "配置Vercel API地址"
   git push origin main
   ```

#### 4. 测试

1. 访问：https://luciuswang.github.io/douyin-treasure/
2. 打开浏览器控制台（F12）
3. 尝试注册/登录
4. 检查Network标签，确认请求发送到Vercel地址

## 🥈 备选方案：LeanCloud（完全国内）

如果Vercel访问不稳定，可以使用LeanCloud：

### 优势
- ✅ 国内服务，速度最快
- ✅ 免费额度充足（30GB存储，10万次API/天）
- ✅ 内置数据库，无需单独配置MongoDB
- ✅ 支持云函数

### 步骤

1. **注册LeanCloud**
   - 访问：https://www.leancloud.cn
   - 注册并创建应用

2. **配置数据库**
   - 数据存储 → 创建Class（User, Treasure等）

3. **部署云函数**
   - 云引擎 → 部署代码
   - 或使用Git部署

4. **获取API地址**
   - 云引擎 → 设置 → 域名

## 📊 方案对比

| 方案 | 国内速度 | 免费额度 | 易用性 | 推荐度 |
|------|---------|---------|--------|--------|
| Vercel + MongoDB Atlas | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| LeanCloud | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| Railway | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Render | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |

## 🎯 我的建议

**首选：Vercel + MongoDB Atlas**
- 国内访问稳定
- 配置简单
- 完全免费
- 自动部署

**备选：LeanCloud**
- 如果Vercel访问有问题
- 需要完全国内服务
- 想要一站式解决方案

## 🆘 遇到问题？

1. **Vercel部署失败**
   - 检查环境变量是否正确
   - 查看Vercel部署日志

2. **国内访问慢**
   - 使用LeanCloud替代
   - 或使用CDN加速

3. **MongoDB连接失败**
   - 检查IP白名单设置
   - 确认连接字符串正确

需要我帮你配置哪个方案？

